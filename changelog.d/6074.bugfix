Poll refactoring with unit tests
